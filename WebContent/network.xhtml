<!DOCTYPE html>
<html lang="en"
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:p="http://primefaces.org/ui"
    xmlns:dt="http://dtools.com/ui">
    <h:head>
        <title>DTools</title>
    </h:head>
    <h:body>
    
    	<h:outputStylesheet library="#{userBean.cssTheme}" name="css/dstyles.css"/>
    	<h:outputStylesheet library="#{userBean.cssTheme}" name="css/icons.css"/>
    	<h:outputStylesheet library="#{userBean.cssTheme}" name="css/fonts.css"/>
    	<h:outputScript library="default" name="js/dtools.js" />
    	
    	<p:growl id="growl" life="2000"/>
    	
    	<h:panelGrid columns="1" cellpadding="0" cellspacing="0" width="100%">
    	
	        <ui:include src="/include/ptoolbar.xhtml"/>
	        
			<h:form id="breadCrumb">
    		<p:breadCrumb>
			    <p:menuitem value="Home" url="home.xhtml" />
			    <p:menuitem value="Network" url="network.xhtml" />
			</p:breadCrumb>
    		</h:form>
    		
			
			<h:panelGrid columns="1" cellpadding="5" cellspacing="0" width="100%">
				
				<h:form id="addNodeDialogForm">
					<h:panelGrid columns="4" cellpadding="5" cellspacing="0" >
					    <p:commandButton value="Add new node" onclick="PF('addDevDlg').show();" icon="ui-icon-plus" />
					    <p:commandButton value="Auto discovery" onclick="PF('autoDiscDlg').show();" icon="ui-icon-plus" />
					    <h:outputLabel value="Monitoring: " />
					    <p:inputSwitch id="actBtn" value="#{pingSchedulerBean.active}">
							<p:ajax update="growl actBtn" listener="#{pingSchedulerBean.togglePingScheduler()}" />
						</p:inputSwitch>
					</h:panelGrid>
				    <p:dialog header="Add new node" widgetVar="addDevDlg" resizable="false" dynamic="true" closable="false">
				    	<h:panelGrid columns="2" cellpadding="2" cellspacing="0">
							<h:outputLabel for="nodeName" value="Name: " />
							<p:inputText id="nodeName" value="#{networkNodesBean.name}" required="true" 
								requiredMessage="Missing node name">
								<f:validator validatorId="newNodeValidator"/>
							</p:inputText>
							<h:outputLabel for="nodeHostname" value="Hostname: " />
							<p:inputText id="nodeHostname" value="#{networkNodesBean.hostname}" required="true" 
								requiredMessage="Missing hostname or ip" />
							<h:outputLabel value="Description: " />
							<p:inputText value="#{networkNodesBean.description}" />
							<h:outputLabel value="Type: " />
							<p:selectOneMenu value="#{networkNodesBean.type}" style="width:130px">
					            <f:selectItem itemLabel="IP Node" itemValue="IP_NODE" />
					            <f:selectItem itemLabel="Server" itemValue="SERVER" />
					            <f:selectItem itemLabel="Router" itemValue="ROUTER" />
					            <f:selectItem itemLabel="Application" itemValue="APPLICATION" />
					        </p:selectOneMenu>
							<f:facet name="footer">
				                <p:commandButton value="Add" update="growl nodeName nodeHostname nodesForm" 
				                	actionListener="#{networkNodesBean.addNodeAction}"
				                	oncomplete="handleDialogRequest('addDevDlg', xhr, status, args)" />
				                <p:commandButton value="Cancel" onclick="PF('addDevDlg').hide();" />
				            </f:facet>
						</h:panelGrid>
				    </p:dialog>
				    <p:dialog header="Auto discovery" widgetVar="autoDiscDlg" resizable="false" dynamic="true" closable="false">
				    	<h:panelGrid columns="2" cellpadding="2" cellspacing="0">
				    		<h:outputLabel for="fromIp" value="From IP: " />
							<p:inputText id="fromIp" value="#{appBean.fromIp}" required="true" 
								requiredMessage="Missing IP address" />
							<h:outputLabel for="toIp" value="From IP: " />
							<p:inputText id="toIp" value="#{appBean.toIp}" required="true" 
								requiredMessage="Missing IP address" />
				    	</h:panelGrid>
				    	<f:facet name="footer">
				                <p:commandButton value="Scan" update="growl" 
				                	actionListener="#{appBean.startAutoDiscover}"
				                	oncomplete="handleDialogRequest('autoDiscDlg', xhr, status, args)" />
				                <p:commandButton value="Cancel" onclick="PF('autoDiscDlg').hide();" />
				            </f:facet>
				    </p:dialog>
				</h:form>
				
				
				<h:form id="nodesForm">
					<h:panelGrid columns="1" cellspacing="5" width="100%">
						<h:dataTable id="nodesTable" value="#{networkNodesBean.nodesList}" var="node" 
							styleClass="table" rowClasses="tableOddRow,tableEvenRow"
							cellpadding="0" cellspacing="0" width="100%">
							
							<h:column headerClass="col0 col1">
								<f:facet name="header">Icon</f:facet>
								<p:link outcome="node" >
								    <f:param name="nodeName" value="#{node.name}" />
								    <p:graphicImage library="#{userBean.cssTheme}" name="img/#{node.icon}" title="#{node.type}" />
								</p:link>
							</h:column>
							
							<h:column headerClass="col0 col1">
								<f:facet name="header">Status</f:facet>
								<h:commandLink id="status" action="#{node.testConnection}">
									<p:graphicImage library="#{userBean.cssTheme}" name="img/#{node.icmpServiceStatusIcon}" title="#{node.icmpServiceStatus}" />
									<f:ajax render="status" />
								</h:commandLink>
							</h:column>
							
							<h:column headerClass="col0 col2">
								<f:facet name="header">Name</f:facet>
								<p:link outcome="node" value="#{node.name}" >
								    <f:param name="nodeName" value="#{node.name}" />
								</p:link>
							</h:column>
							
							<h:column headerClass="col0 col2">
								<f:facet name="header">Hostname</f:facet>
								<p:link outcome="node" value="#{node.hostname}">
									<f:param name="nodeName" value="#{node.name}" />
								</p:link>
							</h:column>
							
							<h:column headerClass="col0">
								<f:facet name="header">Description</f:facet>
								<h:outputText value="#{node.description}" />
							</h:column>
							
							<h:column headerClass="col0 col1">
								<f:facet name="header">Favorite</f:facet>
								<h:commandLink id="favoriteStar" action="#{networkNodesBean.toggleFavorite(node)}">
									<p:graphicImage library="#{userBean.cssTheme}" name="#{node.favorite == true ? 'img/star-full.png' : 'img/star-empty.png'}" />
									<f:ajax render="favoriteStar" />
								</h:commandLink>
							</h:column>
							
							<h:column headerClass="col0 col1">
								<f:facet name="header">Delete</f:facet>
								<h:commandLink action="#{networkNodesBean.deleteNodeAction(node)}">
									<p:graphicImage library="#{userBean.cssTheme}" name="img/remove.png" />
									<f:ajax render="nodesForm" />
								</h:commandLink>
							</h:column>
							
						</h:dataTable>
					<p:poll interval="60" update="nodesTable" />
					</h:panelGrid>
				</h:form>
				
			</h:panelGrid>
			
			<ui:include src="/include/footer.xhtml"/>
        
        </h:panelGrid>
        
    </h:body>
</html>


